<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyDoc - Universal Document Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [view, setView] = useState('home');
            const [template, setTemplate] = useState(null);
            const [data, setData] = useState({});
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [selectedStyle, setSelectedStyle] = useState('classic');
            const [accentColor, setAccentColor] = useState('#3498db');
            const [savedDrafts, setSavedDrafts] = useState([]);
            const [showSaveModal, setShowSaveModal] = useState(false);
            const [draftName, setDraftName] = useState('');
            const [showLoadModal, setShowLoadModal] = useState(false);
            const [uploadedImages, setUploadedImages] = useState({});
            const [documentHistory, setDocumentHistory] = useState([]);
            const [showHistory, setShowHistory] = useState(false);
            const [showTips, setShowTips] = useState(true);

            // Load saved drafts on mount
            useEffect(() => {
                const drafts = localStorage.getItem('easydoc_drafts');
                if (drafts) {
                    setSavedDrafts(JSON.parse(drafts));
                }
                const history = localStorage.getItem('easydoc_history');
                if (history) {
                    setDocumentHistory(JSON.parse(history));
                }
            }, []);

            // Save drafts to localStorage whenever they change
            useEffect(() => {
                if (savedDrafts.length > 0) {
                    localStorage.setItem('easydoc_drafts', JSON.stringify(savedDrafts));
                }
            }, [savedDrafts]);

            // Save history to localStorage
            useEffect(() => {
                if (documentHistory.length > 0) {
                    localStorage.setItem('easydoc_history', JSON.stringify(documentHistory));
                }
            }, [documentHistory]);

            const templates = [
                // FEATURED TEMPLATES
                {
                    id: 'resume',
                    name: 'Professional Resume',
                    icon: 'ðŸ“„',
                    desc: 'Create a professional resume with experience and skills',
                    category: 'Personal',
                    featured: true,
                    fields: [
                        { name: 'fullName', label: 'Full Name', type: 'text', req: true },
                        { name: 'email', label: 'Email', type: 'email', req: true },
                        { name: 'phone', label: 'Phone', type: 'tel', req: true },
                        { name: 'address', label: 'Address', type: 'text' },
                        { name: 'summary', label: 'Professional Summary', type: 'textarea', req: true },
                        { name: 'experience', label: 'Work Experience', type: 'list', req: true,
                            sub: [
                                { name: 'jobTitle', label: 'Job Title' },
                                { name: 'company', label: 'Company' },
                                { name: 'duration', label: 'Duration' },
                                { name: 'description', label: 'Description', type: 'textarea' }
                            ]
                        },
                        { name: 'education', label: 'Education', type: 'list', req: true,
                            sub: [
                                { name: 'degree', label: 'Degree' },
                                { name: 'institution', label: 'Institution' },
                                { name: 'year', label: 'Year' }
                            ]
                        },
                        { name: 'skills', label: 'Skills (comma-separated)', type: 'text', req: true }
                    ]
                },
                {
                    id: 'cv',
                    name: 'Curriculum Vitae (CV)',
                    icon: 'ðŸ“‹',
                    desc: 'Comprehensive academic/professional CV',
                    category: 'Personal',
                    featured: true,
                    hasStyles: true,
                    hasImages: true,
                    imageFields: ['photo'],
                    styles: ['classic', 'modern', 'minimal'],
                    fields: [
                        { name: 'fullName', label: 'Full Name', type: 'text', req: true },
                        { name: 'photo', label: 'Photo (Optional)', type: 'image', help: 'Professional headshot recommended' },
                        { name: 'email', label: 'Email', type: 'email', req: true },
                        { name: 'phone', label: 'Phone', type: 'tel', req: true },
                        { name: 'address', label: 'Address', type: 'text' },
                        { name: 'website', label: 'Website/LinkedIn', type: 'text' },
                        { name: 'objective', label: 'Professional Objective', type: 'textarea', req: true },
                        { name: 'experience', label: 'Professional Experience', type: 'list', req: true,
                            sub: [
                                { name: 'position', label: 'Position' },
                                { name: 'organization', label: 'Organization' },
                                { name: 'location', label: 'Location' },
                                { name: 'dates', label: 'Dates' },
                                { name: 'responsibilities', label: 'Responsibilities', type: 'textarea' }
                            ]
                        },
                        { name: 'education', label: 'Education', type: 'list', req: true,
                            sub: [
                                { name: 'degree', label: 'Degree' },
                                { name: 'institution', label: 'Institution' },
                                { name: 'location', label: 'Location' },
                                { name: 'year', label: 'Year' },
                                { name: 'honors', label: 'Honors/GPA' }
                            ]
                        },
                        { name: 'publications', label: 'Publications', type: 'list',
                            sub: [
                                { name: 'title', label: 'Title' },
                                { name: 'journal', label: 'Journal/Conference' },
                                { name: 'year', label: 'Year' }
                            ]
                        },
                        { name: 'skills', label: 'Skills & Competencies', type: 'textarea', req: true },
                        { name: 'languages', label: 'Languages', type: 'text' },
                        { name: 'certifications', label: 'Certifications', type: 'textarea' }
                    ]
                },
                {
                    id: 'portfolio',
                    name: 'Portfolio',
                    icon: 'ðŸŽ¨',
                    desc: 'Showcase your work and projects',
                    category: 'Personal',
                    featured: true,
                    hasStyles: true,
                    hasImages: true,
                    imageFields: ['profilePhoto'],
                    styles: ['classic', 'modern', 'creative'],
                    fields: [
                        { name: 'fullName', label: 'Your Name', type: 'text', req: true },
                        { name: 'profilePhoto', label: 'Profile Photo (Optional)', type: 'image', help: 'Upload a professional headshot' },
                        { name: 'title', label: 'Professional Title', type: 'text', req: true },
                        { name: 'email', label: 'Email', type: 'email', req: true },
                        { name: 'phone', label: 'Phone', type: 'tel' },
                        { name: 'website', label: 'Website/Portfolio URL', type: 'text' },
                        { name: 'bio', label: 'Professional Bio', type: 'textarea', req: true },
                        { name: 'projects', label: 'Projects', type: 'list', req: true,
                            sub: [
                                { name: 'projectName', label: 'Project Name' },
                                { name: 'role', label: 'Your Role' },
                                { name: 'date', label: 'Date/Year' },
                                { name: 'description', label: 'Description', type: 'textarea' },
                                { name: 'technologies', label: 'Technologies/Tools Used' }
                            ]
                        },
                        { name: 'skills', label: 'Core Skills', type: 'textarea', req: true },
                        { name: 'awards', label: 'Awards & Recognition', type: 'list',
                            sub: [
                                { name: 'award', label: 'Award' },
                                { name: 'organization', label: 'Organization' },
                                { name: 'year', label: 'Year' }
                            ]
                        },
                        { name: 'clients', label: 'Notable Clients/Companies', type: 'text' }
                    ]
                },
                {
                    id: 'invoice',
                    name: 'Business Invoice',
                    icon: 'ðŸ’°',
                    desc: 'Generate professional invoices for clients',
                    category: 'Business',
                    hasImages: true,
                    imageFields: ['logo'],
                    fields: [
                        { name: 'invoiceNumber', label: 'Invoice #', type: 'text', req: true },
                        { name: 'logo', label: 'Company Logo (Optional)', type: 'image', help: 'Add your business logo' },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'dueDate', label: 'Due Date', type: 'date', req: true },
                        { name: 'fromName', label: 'Your Business', type: 'text', req: true },
                        { name: 'fromAddress', label: 'Your Address', type: 'textarea', req: true },
                        { name: 'toName', label: 'Client Name', type: 'text', req: true },
                        { name: 'toAddress', label: 'Client Address', type: 'textarea', req: true },
                        { name: 'items', label: 'Items', type: 'list', req: true,
                            sub: [
                                { name: 'description', label: 'Description' },
                                { name: 'quantity', label: 'Qty', type: 'number' },
                                { name: 'rate', label: 'Rate', type: 'number' }
                            ]
                        },
                        { name: 'notes', label: 'Notes', type: 'textarea' }
                    ]
                },
                {
                    id: 'letter',
                    name: 'Formal Letter',
                    icon: 'âœ‰ï¸',
                    desc: 'Create formal business or personal letters',
                    category: 'Personal',
                    featured: true,
                    fields: [
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'senderName', label: 'Your Name', type: 'text', req: true },
                        { name: 'senderAddress', label: 'Your Address', type: 'textarea', req: true },
                        { name: 'recipientName', label: 'Recipient', type: 'text', req: true },
                        { name: 'recipientAddress', label: 'Recipient Address', type: 'textarea', req: true },
                        { name: 'subject', label: 'Subject', type: 'text', req: true },
                        { name: 'body', label: 'Body', type: 'textarea', req: true },
                        { name: 'closing', label: 'Closing', type: 'text', req: true }
                    ]
                },
                {
                    id: 'certificate',
                    name: 'Certificate',
                    icon: 'ðŸ†',
                    desc: 'Create achievement and completion certificates',
                    category: 'Educational',
                    featured: true,
                    fields: [
                        { name: 'recipientName', label: 'Recipient', type: 'text', req: true },
                        { name: 'achievement', label: 'Achievement', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'organization', label: 'Organization', type: 'text', req: true },
                        { name: 'signerName', label: 'Signer', type: 'text', req: true },
                        { name: 'signerTitle', label: 'Title', type: 'text', req: true }
                    ]
                },
                // BUSINESS TEMPLATES
                {
                    id: 'proposal',
                    name: 'Business Proposal',
                    icon: 'ðŸ“Š',
                    desc: 'Professional business proposal template',
                    category: 'Business',
                    fields: [
                        { name: 'title', label: 'Proposal Title', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'preparedFor', label: 'Prepared For', type: 'text', req: true },
                        { name: 'preparedBy', label: 'Prepared By', type: 'text', req: true },
                        { name: 'executive', label: 'Executive Summary', type: 'textarea', req: true },
                        { name: 'problem', label: 'Problem Statement', type: 'textarea', req: true },
                        { name: 'solution', label: 'Proposed Solution', type: 'textarea', req: true },
                        { name: 'budget', label: 'Budget', type: 'text', req: true },
                        { name: 'timeline', label: 'Timeline', type: 'text', req: true }
                    ]
                },
                {
                    id: 'contract',
                    name: 'Service Agreement',
                    icon: 'ðŸ“',
                    desc: 'Basic service contract template',
                    category: 'Legal',
                    fields: [
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'party1Name', label: 'Service Provider', type: 'text', req: true },
                        { name: 'party1Address', label: 'Provider Address', type: 'textarea', req: true },
                        { name: 'party2Name', label: 'Client', type: 'text', req: true },
                        { name: 'party2Address', label: 'Client Address', type: 'textarea', req: true },
                        { name: 'services', label: 'Services Description', type: 'textarea', req: true },
                        { name: 'compensation', label: 'Compensation', type: 'text', req: true },
                        { name: 'term', label: 'Term/Duration', type: 'text', req: true },
                        { name: 'terms', label: 'Additional Terms', type: 'textarea' }
                    ]
                },
                {
                    id: 'receipt',
                    name: 'Payment Receipt',
                    icon: 'ðŸ§¾',
                    desc: 'Simple payment receipt',
                    category: 'Business',
                    fields: [
                        { name: 'receiptNumber', label: 'Receipt #', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'from', label: 'Received From', type: 'text', req: true },
                        { name: 'amount', label: 'Amount', type: 'text', req: true },
                        { name: 'paymentMethod', label: 'Payment Method', type: 'text', req: true },
                        { name: 'purpose', label: 'Purpose/Description', type: 'textarea', req: true },
                        { name: 'receivedBy', label: 'Received By', type: 'text', req: true }
                    ]
                },
                // PERSONAL TEMPLATES
                {
                    id: 'coverletter',
                    name: 'Cover Letter',
                    icon: 'ðŸ“®',
                    desc: 'Professional job application cover letter',
                    category: 'Personal',
                    fields: [
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'yourName', label: 'Your Name', type: 'text', req: true },
                        { name: 'yourAddress', label: 'Your Address', type: 'textarea', req: true },
                        { name: 'hiringManager', label: 'Hiring Manager', type: 'text', req: true },
                        { name: 'company', label: 'Company', type: 'text', req: true },
                        { name: 'companyAddress', label: 'Company Address', type: 'textarea', req: true },
                        { name: 'position', label: 'Position', type: 'text', req: true },
                        { name: 'body', label: 'Letter Body', type: 'textarea', req: true }
                    ]
                },
                {
                    id: 'reference',
                    name: 'Reference Letter',
                    icon: 'ðŸ’¼',
                    desc: 'Professional reference/recommendation letter',
                    category: 'Personal',
                    fields: [
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'writerName', label: 'Your Name', type: 'text', req: true },
                        { name: 'writerTitle', label: 'Your Title', type: 'text', req: true },
                        { name: 'writerOrg', label: 'Organization', type: 'text', req: true },
                        { name: 'candidateName', label: 'Candidate Name', type: 'text', req: true },
                        { name: 'relationship', label: 'Your Relationship', type: 'text', req: true },
                        { name: 'duration', label: 'Duration Known', type: 'text', req: true },
                        { name: 'recommendation', label: 'Recommendation', type: 'textarea', req: true }
                    ]
                },
                // EVENT TEMPLATES
                {
                    id: 'invitation',
                    name: 'Event Invitation',
                    icon: 'ðŸŽ‰',
                    desc: 'Formal event invitation',
                    category: 'Events',
                    fields: [
                        { name: 'eventName', label: 'Event Name', type: 'text', req: true },
                        { name: 'host', label: 'Hosted By', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'time', label: 'Time', type: 'text', req: true },
                        { name: 'venue', label: 'Venue', type: 'text', req: true },
                        { name: 'address', label: 'Address', type: 'textarea', req: true },
                        { name: 'details', label: 'Event Details', type: 'textarea', req: true },
                        { name: 'rsvp', label: 'RSVP Information', type: 'text' }
                    ]
                },
                {
                    id: 'agenda',
                    name: 'Meeting Agenda',
                    icon: 'ðŸ“‹',
                    desc: 'Professional meeting agenda',
                    category: 'Business',
                    fields: [
                        { name: 'meetingTitle', label: 'Meeting Title', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'time', label: 'Time', type: 'text', req: true },
                        { name: 'location', label: 'Location', type: 'text', req: true },
                        { name: 'organizer', label: 'Organizer', type: 'text', req: true },
                        { name: 'attendees', label: 'Attendees', type: 'textarea', req: true },
                        { name: 'items', label: 'Agenda Items', type: 'list', req: true,
                            sub: [
                                { name: 'topic', label: 'Topic' },
                                { name: 'duration', label: 'Duration' },
                                { name: 'presenter', label: 'Presenter' }
                            ]
                        }
                    ]
                },
                {
                    id: 'timesheet',
                    name: 'Timesheet',
                    icon: 'â°',
                    desc: 'Employee timesheet template',
                    category: 'Business',
                    fields: [
                        { name: 'employeeName', label: 'Employee Name', type: 'text', req: true },
                        { name: 'employeeId', label: 'Employee ID', type: 'text' },
                        { name: 'weekEnding', label: 'Week Ending', type: 'date', req: true },
                        { name: 'department', label: 'Department', type: 'text' },
                        { name: 'entries', label: 'Time Entries', type: 'list', req: true,
                            sub: [
                                { name: 'date', label: 'Date', type: 'date' },
                                { name: 'hoursWorked', label: 'Hours', type: 'number' },
                                { name: 'description', label: 'Description' }
                            ]
                        },
                        { name: 'supervisor', label: 'Supervisor', type: 'text' }
                    ]
                },
                // NEW TEMPLATES
                {
                    id: 'budget',
                    name: 'Budget Report',
                    icon: 'ðŸ’µ',
                    desc: 'Track income and expenses',
                    category: 'Business',
                    fields: [
                        { name: 'title', label: 'Budget Title', type: 'text', req: true },
                        { name: 'period', label: 'Period', type: 'text', req: true },
                        { name: 'preparedBy', label: 'Prepared By', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'income', label: 'Income Items', type: 'list', req: true,
                            sub: [
                                { name: 'source', label: 'Income Source' },
                                { name: 'amount', label: 'Amount', type: 'number' }
                            ]
                        },
                        { name: 'expenses', label: 'Expense Items', type: 'list', req: true,
                            sub: [
                                { name: 'category', label: 'Category' },
                                { name: 'description', label: 'Description' },
                                { name: 'amount', label: 'Amount', type: 'number' }
                            ]
                        },
                        { name: 'notes', label: 'Notes', type: 'textarea' }
                    ]
                },
                {
                    id: 'purchaseorder',
                    name: 'Purchase Order',
                    icon: 'ðŸ›’',
                    desc: 'Create purchase orders for vendors',
                    category: 'Business',
                    fields: [
                        { name: 'poNumber', label: 'PO Number', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'buyerName', label: 'Buyer Company', type: 'text', req: true },
                        { name: 'buyerAddress', label: 'Buyer Address', type: 'textarea', req: true },
                        { name: 'vendorName', label: 'Vendor Name', type: 'text', req: true },
                        { name: 'vendorAddress', label: 'Vendor Address', type: 'textarea', req: true },
                        { name: 'items', label: 'Items to Purchase', type: 'list', req: true,
                            sub: [
                                { name: 'itemName', label: 'Item' },
                                { name: 'quantity', label: 'Quantity', type: 'number' },
                                { name: 'unitPrice', label: 'Unit Price', type: 'number' }
                            ]
                        },
                        { name: 'deliveryDate', label: 'Expected Delivery', type: 'date' },
                        { name: 'terms', label: 'Terms & Conditions', type: 'textarea' }
                    ]
                },
                {
                    id: 'itinerary',
                    name: 'Travel Itinerary',
                    icon: 'âœˆï¸',
                    desc: 'Plan your travel schedule',
                    category: 'Personal',
                    fields: [
                        { name: 'tripTitle', label: 'Trip Title', type: 'text', req: true },
                        { name: 'traveler', label: 'Traveler Name', type: 'text', req: true },
                        { name: 'startDate', label: 'Start Date', type: 'date', req: true },
                        { name: 'endDate', label: 'End Date', type: 'date', req: true },
                        { name: 'destination', label: 'Destination', type: 'text', req: true },
                        { name: 'schedule', label: 'Daily Schedule', type: 'list', req: true,
                            sub: [
                                { name: 'day', label: 'Day/Date' },
                                { name: 'time', label: 'Time' },
                                { name: 'activity', label: 'Activity' },
                                { name: 'location', label: 'Location' }
                            ]
                        },
                        { name: 'accommodation', label: 'Accommodation Details', type: 'textarea' },
                        { name: 'contacts', label: 'Emergency Contacts', type: 'textarea' }
                    ]
                },
                {
                    id: 'mealplan',
                    name: 'Meal Plan',
                    icon: 'ðŸ½ï¸',
                    desc: 'Weekly meal planning template',
                    category: 'Personal',
                    fields: [
                        { name: 'weekOf', label: 'Week Of', type: 'date', req: true },
                        { name: 'planFor', label: 'Plan For', type: 'text', req: true },
                        { name: 'meals', label: 'Daily Meals', type: 'list', req: true,
                            sub: [
                                { name: 'day', label: 'Day' },
                                { name: 'breakfast', label: 'Breakfast' },
                                { name: 'lunch', label: 'Lunch' },
                                { name: 'dinner', label: 'Dinner' },
                                { name: 'snacks', label: 'Snacks' }
                            ]
                        },
                        { name: 'shoppingList', label: 'Shopping List', type: 'textarea' },
                        { name: 'notes', label: 'Notes', type: 'textarea' }
                    ]
                },
                {
                    id: 'minutes',
                    name: 'Meeting Minutes',
                    icon: 'ðŸ“',
                    desc: 'Record meeting discussions and decisions',
                    category: 'Business',
                    fields: [
                        { name: 'meetingTitle', label: 'Meeting Title', type: 'text', req: true },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'time', label: 'Time', type: 'text', req: true },
                        { name: 'location', label: 'Location', type: 'text', req: true },
                        { name: 'attendees', label: 'Attendees', type: 'textarea', req: true },
                        { name: 'absent', label: 'Absent', type: 'text' },
                        { name: 'discussions', label: 'Discussion Points', type: 'list', req: true,
                            sub: [
                                { name: 'topic', label: 'Topic' },
                                { name: 'discussion', label: 'Discussion', type: 'textarea' },
                                { name: 'decision', label: 'Decision/Action' }
                            ]
                        },
                        { name: 'nextMeeting', label: 'Next Meeting', type: 'text' }
                    ]
                },
                {
                    id: 'checklist',
                    name: 'Checklist',
                    icon: 'âœ…',
                    desc: 'Create task and to-do checklists',
                    category: 'Personal',
                    fields: [
                        { name: 'title', label: 'Checklist Title', type: 'text', req: true },
                        { name: 'description', label: 'Description', type: 'textarea' },
                        { name: 'date', label: 'Date', type: 'date', req: true },
                        { name: 'items', label: 'Checklist Items', type: 'list', req: true,
                            sub: [
                                { name: 'task', label: 'Task' },
                                { name: 'priority', label: 'Priority' },
                                { name: 'notes', label: 'Notes' }
                            ]
                        }
                    ]
                }
            ];

            const categories = ['all', 'Business', 'Personal', 'Legal', 'Educational', 'Events'];

            const selectTemplate = (t) => {
                setTemplate(t);
                setSelectedStyle(t.hasStyles ? 'classic' : null);
                const init = {};
                t.fields.forEach(f => {
                    init[f.name] = f.type === 'list' ? [{}] : '';
                });
                setData(init);
                setView('editor');
            };

            const updateData = (k, v) => setData(p => ({ ...p, [k]: v }));
            const addListItem = (k) => setData(p => ({ ...p, [k]: [...(p[k] || []), {}] }));
            const removeListItem = (k, i) => setData(p => ({ ...p, [k]: p[k].filter((_, idx) => idx !== i) }));
            const updateListItem = (k, i, sk, v) => setData(p => ({
                ...p,
                [k]: p[k].map((item, idx) => idx === i ? { ...item, [sk]: v } : item)
            }));

            // Save draft
            const saveDraft = () => {
                if (!draftName.trim()) {
                    alert('Please enter a name for your draft');
                    return;
                }
                const draft = {
                    id: Date.now(),
                    name: draftName,
                    template: template,
                    data: data,
                    style: selectedStyle,
                    accentColor: accentColor,
                    date: new Date().toLocaleDateString()
                };
                setSavedDrafts(prev => [draft, ...prev]);
                setShowSaveModal(false);
                setDraftName('');
                alert('Draft saved successfully!');
            };

            // Load draft
            const loadDraft = (draft) => {
                setTemplate(draft.template);
                setData(draft.data);
                setSelectedStyle(draft.style);
                setAccentColor(draft.accentColor);
                setView('editor');
                setShowLoadModal(false);
            };

            // Delete draft
            const deleteDraft = (id) => {
                if (confirm('Are you sure you want to delete this draft?')) {
                    setSavedDrafts(prev => prev.filter(d => d.id !== id));
                }
            };

            // Handle image upload
            const handleImageUpload = (fieldName, event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) { // 2MB limit
                        alert('Image size should be less than 2MB');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setUploadedImages(prev => ({
                            ...prev,
                            [fieldName]: e.target.result
                        }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Add to document history
            const addToHistory = (templateName) => {
                const historyItem = {
                    id: Date.now(),
                    templateName: templateName,
                    date: new Date().toLocaleString(),
                    timestamp: Date.now()
                };
                setDocumentHistory(prev => [historyItem, ...prev.slice(0, 9)]); // Keep last 10
            };
            const fillSampleData = () => {
                if (!confirm('This will replace your current data with sample data. Continue?')) return;
                
                const samples = {
                    resume: {
                        fullName: 'Jane Doe',
                        email: 'jane.doe@email.com',
                        phone: '+1 (555) 123-4567',
                        address: 'New York, NY',
                        summary: 'Experienced software developer with 5+ years of expertise in full-stack development.',
                        experience: [{ jobTitle: 'Senior Developer', company: 'Tech Corp', duration: '2020-Present', description: 'Led development of key features' }],
                        education: [{ degree: 'BS Computer Science', institution: 'University of Technology', year: '2018' }],
                        skills: 'JavaScript, React, Node.js, Python, SQL'
                    },
                    invoice: {
                        invoiceNumber: 'INV-001',
                        date: '2025-01-06',
                        dueDate: '2025-02-06',
                        fromName: 'Your Company',
                        fromAddress: '123 Business St, City, State 12345',
                        toName: 'Client Name',
                        toAddress: '456 Client Ave, City, State 67890',
                        items: [{ description: 'Web Development Services', quantity: 40, rate: 150 }],
                        notes: 'Payment due within 30 days'
                    }
                };

                if (samples[template.id]) {
                    setData(samples[template.id]);
                } else {
                    alert('Sample data not available for this template');
                }
            };

            const generatePDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let y = 20;
                const w = doc.internal.pageSize.getWidth();
                const m = 20;
                const mw = w - 2 * m;

                // Add to history
                addToHistory(template.name);

                // Helper function for page breaks
                const checkPageBreak = (needed) => {
                    if (y + needed > 270) {
                        doc.addPage();
                        y = 20;
                        return true;
                    }
                    return false;
                };

                // Style configurations
                const applyStyle = (style) => {
                    const hexToRgb = (hex) => {
                        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                        return result ? [
                            parseInt(result[1], 16),
                            parseInt(result[2], 16),
                            parseInt(result[3], 16)
                        ] : [52, 152, 219];
                    };
                    
                    const customColor = hexToRgb(accentColor);
                    
                    if (style === 'modern') {
                        return { primaryColor: customColor, headerSize: 26, accentColor: customColor };
                    } else if (style === 'minimal') {
                        return { primaryColor: [44, 62, 80], headerSize: 22, accentColor: customColor };
                    } else if (style === 'creative') {
                        return { primaryColor: customColor, headerSize: 28, accentColor: customColor };
                    } else { // classic
                        return { primaryColor: [0, 0, 0], headerSize: 24, accentColor: customColor };
                    }
                };

                const styleConfig = applyStyle(selectedStyle);

                if (template.id === 'resume') {
                    if (selectedStyle === 'modern') {
                        // Modern Resume Style
                        doc.setFillColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.rect(0, 0, w, 35, 'F');
                        
                        // Add photo if uploaded
                        if (uploadedImages.photo) {
                            doc.addImage(uploadedImages.photo, 'JPEG', w - 40, 5, 25, 25);
                        }
                        
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.text(data.fullName || '', w / 2, 15, { align: 'center' });
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.text(`${data.email || ''} | ${data.phone || ''}`, w / 2, 25, { align: 'center' });
                        y = 45;
                        doc.setTextColor(0, 0, 0);
                    } else if (selectedStyle === 'minimal') {
                        // Minimal Resume Style
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.text(data.fullName || '', m, y);
                        y += 8;
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(100, 100, 100);
                        doc.text(`${data.email || ''} â€¢ ${data.phone || ''} â€¢ ${data.address || ''}`, m, y);
                        y += 15;
                        doc.setTextColor(0, 0, 0);
                    } else {
                        // Classic Resume Style
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.text(data.fullName || '', w / 2, y, { align: 'center' });
                        y += 10;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.text(`${data.email || ''} | ${data.phone || ''} | ${data.address || ''}`, w / 2, y, { align: 'center' });
                        y += 15;
                    }

                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                    doc.text('PROFESSIONAL SUMMARY', m, y);
                    y += 7;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    const sum = doc.splitTextToSize(data.summary || '', mw);
                    doc.text(sum, m, y);
                    y += sum.length * 5 + 10;

                    if (data.experience?.length) {
                        checkPageBreak(20);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('WORK EXPERIENCE', m, y);
                        y += 7;
                        data.experience.forEach(e => {
                            checkPageBreak(30);
                            doc.setFontSize(11);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(0, 0, 0);
                            doc.text(e.jobTitle || '', m, y);
                            doc.setFont(undefined, 'normal');
                            doc.text(e.duration || '', w - m, y, { align: 'right' });
                            y += 6;
                            doc.setFontSize(10);
                            doc.setFont(undefined, 'italic');
                            doc.text(e.company || '', m, y);
                            y += 6;
                            doc.setFont(undefined, 'normal');
                            const d = doc.splitTextToSize(e.description || '', mw);
                            doc.text(d, m, y);
                            y += d.length * 5 + 8;
                        });
                    }

                    if (data.education?.length) {
                        checkPageBreak(20);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('EDUCATION', m, y);
                        y += 7;
                        data.education.forEach(e => {
                            doc.setFontSize(11);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(0, 0, 0);
                            doc.text(e.degree || '', m, y);
                            doc.setFont(undefined, 'normal');
                            doc.text(e.year || '', w - m, y, { align: 'right' });
                            y += 6;
                            doc.setFontSize(10);
                            doc.text(e.institution || '', m, y);
                            y += 8;
                        });
                    }

                    if (data.skills) {
                        checkPageBreak(15);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('SKILLS', m, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(0, 0, 0);
                        const sk = doc.splitTextToSize(data.skills, mw);
                        doc.text(sk, m, y);
                    }
                } else if (template.id === 'cv') {
                    // CV Generation with styles
                    if (selectedStyle === 'modern') {
                        doc.setFillColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.rect(0, 0, 60, doc.internal.pageSize.getHeight(), 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(20);
                        doc.setFont(undefined, 'bold');
                        const nameLines = doc.splitTextToSize(data.fullName || '', 50);
                        doc.text(nameLines, 5, 20);
                        y = 20 + nameLines.length * 8;
                        doc.setFontSize(8);
                        doc.setFont(undefined, 'normal');
                        doc.text(data.email || '', 5, y);
                        y += 5;
                        doc.text(data.phone || '', 5, y);
                        y += 5;
                        if (data.website) {
                            doc.text(data.website, 5, y);
                        }
                        
                        // Main content area
                        y = 20;
                        const contentX = 65;
                        const contentW = w - contentX - m;
                        doc.setTextColor(0, 0, 0);
                        
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text('PROFESSIONAL OBJECTIVE', contentX, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        const obj = doc.splitTextToSize(data.objective || '', contentW);
                        doc.text(obj, contentX, y);
                        y += obj.length * 5 + 10;

                        if (data.experience?.length) {
                            checkPageBreak(20);
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.text('EXPERIENCE', contentX, y);
                            y += 7;
                            data.experience.forEach(e => {
                                checkPageBreak(25);
                                doc.setFontSize(11);
                                doc.setFont(undefined, 'bold');
                                doc.text(e.position || '', contentX, y);
                                y += 6;
                                doc.setFontSize(10);
                                doc.setFont(undefined, 'italic');
                                doc.text(`${e.organization || ''} - ${e.location || ''}`, contentX, y);
                                y += 5;
                                doc.setFont(undefined, 'normal');
                                doc.text(e.dates || '', contentX, y);
                                y += 6;
                                const resp = doc.splitTextToSize(e.responsibilities || '', contentW);
                                doc.text(resp, contentX, y);
                                y += resp.length * 5 + 8;
                            });
                        }
                    } else {
                        // Classic/Minimal CV Style
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.text(data.fullName || '', w / 2, y, { align: 'center' });
                        y += 8;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(0, 0, 0);
                        doc.text(`${data.email || ''} | ${data.phone || ''} | ${data.website || ''}`, w / 2, y, { align: 'center' });
                        y += 15;

                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('PROFESSIONAL OBJECTIVE', m, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(0, 0, 0);
                        const obj = doc.splitTextToSize(data.objective || '', mw);
                        doc.text(obj, m, y);
                        y += obj.length * 5 + 10;

                        if (data.experience?.length) {
                            checkPageBreak(20);
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                            doc.text('PROFESSIONAL EXPERIENCE', m, y);
                            y += 7;
                            data.experience.forEach(e => {
                                checkPageBreak(25);
                                doc.setFontSize(11);
                                doc.setFont(undefined, 'bold');
                                doc.setTextColor(0, 0, 0);
                                doc.text(e.position || '', m, y);
                                doc.setFont(undefined, 'normal');
                                doc.text(e.dates || '', w - m, y, { align: 'right' });
                                y += 6;
                                doc.setFontSize(10);
                                doc.setFont(undefined, 'italic');
                                doc.text(`${e.organization || ''}, ${e.location || ''}`, m, y);
                                y += 6;
                                doc.setFont(undefined, 'normal');
                                const resp = doc.splitTextToSize(e.responsibilities || '', mw);
                                doc.text(resp, m, y);
                                y += resp.length * 5 + 8;
                            });
                        }

                        if (data.education?.length) {
                            checkPageBreak(20);
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                            doc.text('EDUCATION', m, y);
                            y += 7;
                            data.education.forEach(e => {
                                doc.setFontSize(11);
                                doc.setFont(undefined, 'bold');
                                doc.setTextColor(0, 0, 0);
                                doc.text(`${e.degree || ''} ${e.honors ? '(' + e.honors + ')' : ''}`, m, y);
                                doc.setFont(undefined, 'normal');
                                doc.text(e.year || '', w - m, y, { align: 'right' });
                                y += 6;
                                doc.setFontSize(10);
                                doc.text(`${e.institution || ''}, ${e.location || ''}`, m, y);
                                y += 8;
                            });
                        }

                        if (data.publications?.length && data.publications[0].title) {
                            checkPageBreak(20);
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                            doc.text('PUBLICATIONS', m, y);
                            y += 7;
                            data.publications.forEach(p => {
                                if (p.title) {
                                    doc.setFontSize(10);
                                    doc.setFont(undefined, 'normal');
                                    doc.setTextColor(0, 0, 0);
                                    doc.text(`${p.title}. ${p.journal || ''}. ${p.year || ''}`, m, y);
                                    y += 6;
                                }
                            });
                            y += 4;
                        }

                        if (data.skills) {
                            checkPageBreak(15);
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                            doc.text('SKILLS & COMPETENCIES', m, y);
                            y += 7;
                            doc.setFontSize(10);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(0, 0, 0);
                            const sk = doc.splitTextToSize(data.skills, mw);
                            doc.text(sk, m, y);
                        }
                    }
                } else if (template.id === 'portfolio') {
                    // Portfolio Generation with styles
                    if (selectedStyle === 'creative') {
                        // Creative Portfolio Style
                        doc.setFillColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.rect(0, 0, w, 45, 'F');
                        
                        // Add profile photo if uploaded
                        if (uploadedImages.profilePhoto) {
                            doc.addImage(uploadedImages.profilePhoto, 'JPEG', w / 2 - 15, 50, 30, 30);
                            y = 90;
                        }
                        
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.text(data.fullName || '', w / 2, 20, { align: 'center' });
                        doc.setFontSize(14);
                        doc.setFont(undefined, 'normal');
                        doc.text(data.title || '', w / 2, 30, { align: 'center' });
                        doc.setFontSize(9);
                        doc.text(`${data.email || ''} | ${data.phone || ''}`, w / 2, 38, { align: 'center' });
                        y = 55;
                        doc.setTextColor(0, 0, 0);
                    } else if (selectedStyle === 'modern') {
                        // Modern Portfolio Style
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.primaryColor[0], styleConfig.primaryColor[1], styleConfig.primaryColor[2]);
                        doc.text(data.fullName || '', m, y);
                        y += 8;
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'normal');
                        doc.text(data.title || '', m, y);
                        y += 8;
                        doc.setFontSize(9);
                        doc.setTextColor(100, 100, 100);
                        doc.text(`${data.email || ''} | ${data.phone || ''} | ${data.website || ''}`, m, y);
                        y += 15;
                        doc.setTextColor(0, 0, 0);
                    } else {
                        // Classic Portfolio Style
                        doc.setFontSize(styleConfig.headerSize);
                        doc.setFont(undefined, 'bold');
                        doc.text(data.fullName || '', w / 2, y, { align: 'center' });
                        y += 8;
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'italic');
                        doc.text(data.title || '', w / 2, y, { align: 'center' });
                        y += 10;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.text(`${data.email || ''} | ${data.phone || ''} | ${data.website || ''}`, w / 2, y, { align: 'center' });
                        y += 15;
                    }

                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                    doc.text('ABOUT', m, y);
                    y += 7;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    const bio = doc.splitTextToSize(data.bio || '', mw);
                    doc.text(bio, m, y);
                    y += bio.length * 5 + 10;

                    if (data.projects?.length) {
                        checkPageBreak(20);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('FEATURED PROJECTS', m, y);
                        y += 7;
                        data.projects.forEach((p, idx) => {
                            checkPageBreak(30);
                            doc.setFontSize(11);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(0, 0, 0);
                            doc.text(`${idx + 1}. ${p.projectName || ''}`, m, y);
                            y += 6;
                            doc.setFontSize(10);
                            doc.setFont(undefined, 'italic');
                            doc.text(`${p.role || ''} | ${p.date || ''}`, m, y);
                            y += 6;
                            doc.setFont(undefined, 'normal');
                            const desc = doc.splitTextToSize(p.description || '', mw);
                            doc.text(desc, m, y);
                            y += desc.length * 5 + 3;
                            if (p.technologies) {
                                doc.setFontSize(9);
                                doc.setTextColor(100, 100, 100);
                                doc.text(`Technologies: ${p.technologies}`, m, y);
                                y += 6;
                                doc.setTextColor(0, 0, 0);
                            }
                            y += 5;
                        });
                    }

                    if (data.skills) {
                        checkPageBreak(15);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(styleConfig.accentColor[0], styleConfig.accentColor[1], styleConfig.accentColor[2]);
                        doc.text('CORE SKILLS', m, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(0, 0, 0);
                        const sk = doc.splitTextToSize(data.skills, mw);
                        doc.text(sk, m, y);
                    }
                } else if (template.id === 'invoice') {
                    doc.setFontSize(24);
                    doc.setFont(undefined, 'bold');
                    
                    // Add logo if uploaded
                    if (uploadedImages.logo) {
                        doc.addImage(uploadedImages.logo, 'JPEG', w - 50, 10, 30, 30);
                    }
                    
                    doc.text('INVOICE', m, y);
                    y += 15;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Invoice #: ${data.invoiceNumber || ''}`, m, y);
                    y += 6;
                    doc.text(`Date: ${data.date || ''}`, m, y);
                    y += 6;
                    doc.text(`Due Date: ${data.dueDate || ''}`, m, y);
                    y += 15;
                    doc.setFont(undefined, 'bold');
                    doc.text('FROM:', m, y);
                    y += 6;
                    doc.setFont(undefined, 'normal');
                    doc.text(data.fromName || '', m, y);
                    y += 6;
                    const fa = doc.splitTextToSize(data.fromAddress || '', 80);
                    doc.text(fa, m, y);
                    
                    const ty = 55;
                    doc.setFont(undefined, 'bold');
                    doc.text('TO:', w - m - 80, ty);
                    doc.setFont(undefined, 'normal');
                    doc.text(data.toName || '', w - m - 80, ty + 6);
                    const ta = doc.splitTextToSize(data.toAddress || '', 80);
                    doc.text(ta, w - m - 80, ty + 12);
                    
                    y += fa.length * 5 + 15;
                    doc.setFillColor(240, 240, 240);
                    doc.rect(m, y, mw, 8, 'F');
                    doc.setFont(undefined, 'bold');
                    doc.text('Description', m + 2, y + 5);
                    doc.text('Qty', w - 90, y + 5);
                    doc.text('Rate', w - 60, y + 5);
                    doc.text('Amount', w - m - 2, y + 5, { align: 'right' });
                    y += 12;
                    
                    doc.setFont(undefined, 'normal');
                    let total = 0;
                    if (data.items) {
                        data.items.forEach(it => {
                            const q = parseFloat(it.quantity) || 0;
                            const r = parseFloat(it.rate) || 0;
                            const amt = q * r;
                            total += amt;
                            doc.text(it.description || '', m + 2, y);
                            doc.text(q.toString(), w - 90, y);
                            doc.text(`$${r.toFixed(2)}`, w - 60, y);
                            doc.text(`$${amt.toFixed(2)}`, w - m - 2, y, { align: 'right' });
                            y += 8;
                        });
                    }
                    
                    y += 5;
                    doc.setDrawColor(200, 200, 200);
                    doc.line(w - 80, y, w - m, y);
                    y += 8;
                    doc.setFont(undefined, 'bold');
                    doc.setFontSize(12);
                    doc.text('TOTAL:', w - 80, y);
                    doc.text(`$${total.toFixed(2)}`, w - m - 2, y, { align: 'right' });
                    
                    if (data.notes) {
                        y += 20;
                        doc.setFontSize(10);
                        doc.text('Notes:', m, y);
                        y += 6;
                        doc.setFont(undefined, 'normal');
                        const n = doc.splitTextToSize(data.notes, mw);
                        doc.text(n, m, y);
                    }
                } else if (template.id === 'letter' || template.id === 'coverletter') {
                    doc.setFontSize(10);
                    doc.text(data.senderName || data.yourName || '', m, y);
                    y += 5;
                    const sa = doc.splitTextToSize(data.senderAddress || data.yourAddress || '', mw);
                    doc.text(sa, m, y);
                    y += sa.length * 5 + 10;
                    doc.text(data.date || '', m, y);
                    y += 15;
                    doc.text(data.recipientName || data.hiringManager || '', m, y);
                    y += 5;
                    if (data.company) {
                        doc.text(data.company, m, y);
                        y += 5;
                    }
                    const ra = doc.splitTextToSize(data.recipientAddress || data.companyAddress || '', mw);
                    doc.text(ra, m, y);
                    y += ra.length * 5 + 15;
                    if (data.subject) {
                        doc.setFont(undefined, 'bold');
                        doc.text(`Re: ${data.subject}`, m, y);
                        y += 10;
                    }
                    if (data.position) {
                        doc.setFont(undefined, 'bold');
                        doc.text(`Re: ${data.position}`, m, y);
                        y += 10;
                    }
                    doc.setFont(undefined, 'normal');
                    const greeting = data.recipientName ? `Dear ${data.recipientName},` : data.hiringManager ? `Dear ${data.hiringManager},` : 'Dear Sir/Madam,';
                    doc.text(greeting, m, y);
                    y += 10;
                    const b = doc.splitTextToSize(data.body || '', mw);
                    doc.text(b, m, y);
                    y += b.length * 5 + 15;
                    doc.text(data.closing || 'Sincerely,', m, y);
                    y += 15;
                    doc.text(data.senderName || data.yourName || '', m, y);
                } else if (template.id === 'certificate') {
                    doc.setFillColor(245, 245, 250);
                    doc.rect(0, 0, w, doc.internal.pageSize.getHeight(), 'F');
                    doc.setDrawColor(100, 100, 200);
                    doc.setLineWidth(3);
                    doc.rect(15, 15, w - 30, doc.internal.pageSize.getHeight() - 30);
                    y = 50;
                    doc.setFontSize(32);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(60, 60, 120);
                    doc.text('Certificate of Achievement', w / 2, y, { align: 'center' });
                    y += 30;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    doc.text('This certifies that', w / 2, y, { align: 'center' });
                    y += 20;
                    doc.setFontSize(24);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(100, 100, 200);
                    doc.text(data.recipientName || '', w / 2, y, { align: 'center' });
                    y += 20;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    doc.text('has successfully completed', w / 2, y, { align: 'center' });
                    y += 15;
                    doc.setFontSize(18);
                    doc.setFont(undefined, 'bold');
                    doc.text(data.achievement || '', w / 2, y, { align: 'center' });
                    y += 25;
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Date: ${data.date || ''}`, w / 2, y, { align: 'center' });
                    y += 30;
                    doc.setFontSize(10);
                    doc.text(data.signerName || '', w / 2 - 40, y, { align: 'center' });
                    doc.text(data.organization || '', w / 2 + 40, y, { align: 'center' });
                    y += 2;
                    doc.line(w / 2 - 70, y, w / 2 - 10, y);
                    doc.line(w / 2 + 10, y, w / 2 + 70, y);
                    y += 5;
                    doc.setFont(undefined, 'italic');
                    doc.text(data.signerTitle || '', w / 2 - 40, y, { align: 'center' });
                    doc.text('Organization', w / 2 + 40, y, { align: 'center' });
                } else {
                    // Generic document layout for other templates
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text(template.name, w / 2, y, { align: 'center' });
                    y += 15;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    template.fields.forEach(field => {
                        if (field.type === 'list' && data[field.name]) {
                            checkPageBreak(30);
                            doc.setFont(undefined, 'bold');
                            doc.text(field.label + ':', m, y);
                            y += 7;
                            doc.setFont(undefined, 'normal');
                            data[field.name].forEach((item, idx) => {
                                checkPageBreak(20);
                                doc.text(`${idx + 1}.`, m, y);
                                let itemText = '';
                                field.sub.forEach(sf => {
                                    if (item[sf.name]) itemText += item[sf.name] + ' ';
                                });
                                const lines = doc.splitTextToSize(itemText, mw - 10);
                                doc.text(lines, m + 5, y);
                                y += lines.length * 5 + 3;
                            });
                            y += 5;
                        } else if (data[field.name]) {
                            checkPageBreak(15);
                            doc.setFont(undefined, 'bold');
                            doc.text(field.label + ':', m, y);
                            y += 6;
                            doc.setFont(undefined, 'normal');
                            const content = doc.splitTextToSize(data[field.name].toString(), mw);
                            doc.text(content, m, y);
                            y += content.length * 5 + 8;
                        }
                    });
                }

                doc.save(`${template.name.replace(/\s+/g, '_')}.pdf`);
            };

            const renderField = (f) => {
                if (f.type === 'image') {
                    return (
                        <div key={f.name} className="mb-4">
                            <label className="block text-sm font-medium mb-2">
                                {f.label} {f.req && <span className="text-red-500">*</span>}
                                {f.help && (
                                    <span className="ml-2 text-xs text-gray-500 italic">ðŸ’¡ {f.help}</span>
                                )}
                            </label>
                            <input
                                type="file"
                                accept="image/*"
                                onChange={(e) => handleImageUpload(f.name, e)}
                                className="w-full px-4 py-2 border rounded-lg"
                            />
                            {uploadedImages[f.name] && (
                                <div className="mt-2">
                                    <img src={uploadedImages[f.name]} alt="Preview" className="w-32 h-32 object-cover rounded-lg border" />
                                    <button 
                                        onClick={() => setUploadedImages(prev => {
                                            const newImages = {...prev};
                                            delete newImages[f.name];
                                            return newImages;
                                        })}
                                        className="mt-2 text-sm text-red-600 hover:text-red-700"
                                    >
                                        Remove Image
                                    </button>
                                </div>
                            )}
                        </div>
                    );
                }
                
                if (f.type === 'list') {
                    return (
                        <div key={f.name} className="mb-6">
                            <label className="block text-sm font-medium mb-2">
                                {f.label} {f.req && <span className="text-red-500">*</span>}
                            </label>
                            {(data[f.name] || [{}]).map((item, i) => (
                                <div key={i} className="bg-gray-50 p-4 rounded-lg mb-3">
                                    <div className="flex justify-between mb-3">
                                        <span className="text-sm font-medium">Item {i + 1}</span>
                                        {data[f.name].length > 1 && (
                                            <button onClick={() => removeListItem(f.name, i)} className="text-red-500 hover:text-red-700 text-sm">
                                                Remove
                                            </button>
                                        )}
                                    </div>
                                    {f.sub.map(sf => (
                                        <div key={sf.name} className="mb-2">
                                            <label className="block text-xs mb-1">{sf.label}</label>
                                            {sf.type === 'textarea' ? (
                                                <textarea
                                                    value={item[sf.name] || ''}
                                                    onChange={(e) => updateListItem(f.name, i, sf.name, e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg text-sm"
                                                    rows="2"
                                                />
                                            ) : (
                                                <input
                                                    type={sf.type || 'text'}
                                                    value={item[sf.name] || ''}
                                                    onChange={(e) => updateListItem(f.name, i, sf.name, e.target.value)}
                                                    className="w-full px-3 py-2 border rounded-lg text-sm"
                                                />
                                            )}
                                        </div>
                                    ))}
                                </div>
                            ))}
                            <button onClick={() => addListItem(f.name)} className="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                + Add {f.label}
                            </button>
                        </div>
                    );
                }

                return (
                    <div key={f.name} className="mb-4">
                        <label className="block text-sm font-medium mb-2">
                            {f.label} {f.req && <span className="text-red-500">*</span>}
                            {f.help && (
                                <span className="ml-2 text-xs text-gray-500 italic">ðŸ’¡ {f.help}</span>
                            )}
                        </label>
                        {f.type === 'textarea' ? (
                            <textarea
                                value={data[f.name] || ''}
                                onChange={(e) => updateData(f.name, e.target.value)}
                                className="w-full px-4 py-2 border rounded-lg"
                                rows="4"
                            />
                        ) : (
                            <input
                                type={f.type || 'text'}
                                value={data[f.name] || ''}
                                onChange={(e) => updateData(f.name, e.target.value)}
                                className="w-full px-4 py-2 border rounded-lg"
                            />
                        )}
                    </div>
                );
            };

            if (view === 'editor' && template) {
                const styleVisuals = {
                    classic: {
                        name: 'Classic',
                        icon: 'ðŸ“„',
                        preview: (
                            <div className="w-full h-24 bg-white border-2 border-gray-300 rounded p-2">
                                <div className="h-3 bg-gray-800 w-1/2 mx-auto mb-2"></div>
                                <div className="h-2 bg-gray-400 w-3/4 mx-auto mb-1"></div>
                                <div className="h-2 bg-gray-300 w-full mb-1"></div>
                                <div className="h-2 bg-gray-300 w-full"></div>
                            </div>
                        )
                    },
                    modern: {
                        name: 'Modern',
                        icon: 'âœ¨',
                        preview: (
                            <div className="w-full h-24 bg-white border-2 border-blue-400 rounded overflow-hidden">
                                <div className="h-8 bg-blue-500 flex items-center justify-center">
                                    <div className="h-2 bg-white w-1/3"></div>
                                </div>
                                <div className="p-2">
                                    <div className="h-2 bg-gray-300 w-full mb-1"></div>
                                    <div className="h-2 bg-gray-300 w-3/4"></div>
                                </div>
                            </div>
                        )
                    },
                    minimal: {
                        name: 'Minimal',
                        icon: 'â—»ï¸',
                        preview: (
                            <div className="w-full h-24 bg-white border-2 border-gray-200 rounded p-2">
                                <div className="h-2 bg-gray-800 w-1/3 mb-2"></div>
                                <div className="h-1 bg-gray-300 w-1/2 mb-2"></div>
                                <div className="space-y-1">
                                    <div className="h-1 bg-gray-200 w-full"></div>
                                    <div className="h-1 bg-gray-200 w-full"></div>
                                    <div className="h-1 bg-gray-200 w-4/5"></div>
                                </div>
                            </div>
                        )
                    },
                    creative: {
                        name: 'Creative',
                        icon: 'ðŸŽ¨',
                        preview: (
                            <div className="w-full h-24 bg-white border-2 border-purple-400 rounded overflow-hidden">
                                <div className="h-10 bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                                    <div className="h-2 bg-white w-1/3"></div>
                                </div>
                                <div className="p-2">
                                    <div className="h-2 bg-purple-300 w-full mb-1"></div>
                                    <div className="h-2 bg-purple-200 w-3/4"></div>
                                </div>
                            </div>
                        )
                    }
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                        <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
                            <button onClick={() => { setView('home'); setTemplate(null); }} className="text-gray-600 hover:text-gray-800 mb-6 flex items-center gap-2">
                                â† Back to Templates
                            </button>
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-3">
                                    <span className="text-4xl">{template.icon}</span>
                                    <div>
                                        <h2 className="text-2xl font-bold">{template.name}</h2>
                                        <p className="text-sm text-gray-600">{template.desc}</p>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setShowLoadModal(true)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium">
                                        ðŸ“‚ Load
                                    </button>
                                    <button onClick={() => setShowSaveModal(true)} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-sm font-medium text-blue-700">
                                        ðŸ’¾ Save Draft
                                    </button>
                                    <button onClick={fillSampleData} className="px-4 py-2 bg-green-100 hover:bg-green-200 rounded-lg text-sm font-medium text-green-700">
                                        âœ¨ Sample Data
                                    </button>
                                </div>
                            </div>

                            {/* Color Picker */}
                            <div className="mb-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h3 className="text-sm font-semibold mb-1">Customize Your Colors ðŸŽ¨</h3>
                                        <p className="text-xs text-gray-600">Choose an accent color for your document</p>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <input 
                                            type="color" 
                                            value={accentColor} 
                                            onChange={(e) => setAccentColor(e.target.value)}
                                            className="w-12 h-12 rounded cursor-pointer border-2 border-white shadow"
                                        />
                                        <div className="text-sm font-mono">{accentColor}</div>
                                    </div>
                                </div>
                            </div>

                            {/* Style Selector */}
                            {template.hasStyles && (
                                <div className="mb-8 p-4 bg-gray-50 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Choose Your Style</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        {template.styles.map(style => (
                                            <div
                                                key={style}
                                                onClick={() => setSelectedStyle(style)}
                                                className={`cursor-pointer rounded-lg p-3 transition ${
                                                    selectedStyle === style
                                                        ? 'ring-2 ring-blue-500 bg-blue-50'
                                                        : 'bg-white hover:shadow-md'
                                                }`}
                                            >
                                                <div className="text-center mb-2">
                                                    <span className="text-2xl">{styleVisuals[style].icon}</span>
                                                    <p className="text-sm font-medium mt-1">{styleVisuals[style].name}</p>
                                                </div>
                                                {styleVisuals[style].preview}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="space-y-4">
                                {template.fields.map(renderField)}
                                <button onClick={generatePDF} className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 mt-6">
                                    Download PDF
                                </button>
                            </div>
                        </div>

                        {/* Save Modal */}
                        {showSaveModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Save Draft</h3>
                                    <input
                                        type="text"
                                        value={draftName}
                                        onChange={(e) => setDraftName(e.target.value)}
                                        placeholder="Enter draft name..."
                                        className="w-full px-4 py-2 border rounded-lg mb-4"
                                    />
                                    <div className="flex gap-2">
                                        <button onClick={saveDraft} className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700">
                                            Save
                                        </button>
                                        <button onClick={() => { setShowSaveModal(false); setDraftName(''); }} className="flex-1 bg-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Load Modal */}
                        {showLoadModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                                    <h3 className="text-xl font-bold mb-4">Load Draft</h3>
                                    {savedDrafts.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">No saved drafts yet</p>
                                    ) : (
                                        <div className="space-y-2">
                                            {savedDrafts.map(draft => (
                                                <div key={draft.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                                                    <div className="flex-1">
                                                        <div className="font-semibold">{draft.name}</div>
                                                        <div className="text-sm text-gray-600">{draft.template.name} â€¢ {draft.date}</div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => loadDraft(draft)} className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                                            Load
                                                        </button>
                                                        <button onClick={() => deleteDraft(draft.id)} className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    <button onClick={() => setShowLoadModal(false)} className="w-full mt-4 bg-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">
                                        Close
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            const featuredTemplates = templates.filter(t => t.featured);
            const filteredTemplates = selectedCategory === 'all' 
                ? templates // Show ALL templates including featured ones
                : templates.filter(t => t.category === selectedCategory); // Show all in category

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-5xl font-bold text-gray-800 mb-4">EasyDoc</h1>
                            <p className="text-gray-600 text-lg mb-4">Create professional documents in minutes. Choose from our library of templates.</p>
                            <div className="flex gap-3 justify-center">
                                <button 
                                    onClick={() => setShowHistory(true)}
                                    className="px-6 py-2 bg-white rounded-lg shadow hover:shadow-lg transition font-medium text-gray-700"
                                >
                                    ðŸ“Š Recent Documents ({documentHistory.length})
                                </button>
                                {showTips && (
                                    <div className="flex items-center gap-2 px-6 py-2 bg-blue-50 rounded-lg border border-blue-200">
                                        <span className="text-sm text-blue-800">ðŸ’¡ <strong>Tip:</strong> You can save drafts and come back later!</span>
                                        <button onClick={() => setShowTips(false)} className="text-blue-600 hover:text-blue-800">âœ•</button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Featured Templates */}
                        <div className="mb-12">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                <span className="text-yellow-500">â­</span> Most Popular Templates
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {featuredTemplates.map(t => (
                                    <div key={t.id} onClick={() => selectTemplate(t)} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-2xl cursor-pointer border-2 border-yellow-200 hover:border-yellow-400 transition transform hover:-translate-y-1">
                                        <div className="text-center">
                                            <span className="text-5xl block mb-3">{t.icon}</span>
                                            <h3 className="text-lg font-bold mb-2">{t.name}</h3>
                                            <p className="text-gray-600 text-sm mb-4">{t.desc}</p>
                                            <span className="text-blue-600 font-semibold text-sm">Create Document â†’</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* All Templates Section */}
                        <div>
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">All Templates</h2>
                                <div className="flex gap-2 flex-wrap">
                                    {categories.map(cat => (
                                        <button
                                            key={cat}
                                            onClick={() => setSelectedCategory(cat)}
                                            className={`px-4 py-2 rounded-lg font-medium text-sm transition ${
                                                selectedCategory === cat
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-white text-gray-700 hover:bg-gray-100'
                                            }`}
                                        >
                                            {cat === 'all' ? 'All' : cat}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredTemplates.map(t => (
                                    <div key={t.id} onClick={() => selectTemplate(t)} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl cursor-pointer border-2 border-transparent hover:border-blue-300 transition">
                                        <div className="flex items-start gap-4">
                                            <span className="text-4xl">{t.icon}</span>
                                            <div className="flex-1">
                                                <div className="flex items-start justify-between mb-2">
                                                    <h3 className="text-lg font-bold">{t.name}</h3>
                                                    <span className="text-xs bg-gray-100 px-2 py-1 rounded">{t.category}</span>
                                                </div>
                                                <p className="text-gray-600 text-sm mb-3">{t.desc}</p>
                                                <span className="text-blue-600 font-semibold text-sm">Create â†’</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Footer Info */}
                        <div className="mt-16 bg-white rounded-xl shadow-lg p-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">How It Works</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div className="text-center">
                                    <div className="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span className="text-3xl">1ï¸âƒ£</span>
                                    </div>
                                    <h3 className="font-semibold text-gray-800 mb-2">Choose Template</h3>
                                    <p className="text-gray-600 text-sm">Browse our library and select the document you need</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span className="text-3xl">2ï¸âƒ£</span>
                                    </div>
                                    <h3 className="font-semibold text-gray-800 mb-2">Fill Information</h3>
                                    <p className="text-gray-600 text-sm">Enter your details in the easy-to-use form</p>
                                </div>
                                <div className="text-center">
                                    <div className="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span className="text-3xl">3ï¸âƒ£</span>
                                    </div>
                                    <h3 className="font-semibold text-gray-800 mb-2">Download PDF</h3>
                                    <p className="text-gray-600 text-sm">Get your professional document instantly</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Document History Modal */}
                    {showHistory && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                                <h3 className="text-xl font-bold mb-4">Recent Documents</h3>
                                {documentHistory.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">No documents created yet</p>
                                ) : (
                                    <div className="space-y-2">
                                        {documentHistory.map(item => (
                                            <div key={item.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                <div>
                                                    <div className="font-semibold">{item.templateName}</div>
                                                    <div className="text-sm text-gray-600">{item.date}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <button onClick={() => setShowHistory(false)} className="w-full mt-4 bg-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">
                                    Close
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
